---
# Default variables for the_bastion role

# Installation directory for The Bastion
bastion_install_dir: /opt/bastion

# The Bastion version to install (latest release tag)
bastion_version: "v3.21.00"

# Whether to use git clone or tarball installation
bastion_install_method: tarball  # or 'git'

# GitHub repository for The Bastion
bastion_github_repo: "https://github.com/ovh/the-bastion"

# Whether to install syslog-ng (recommended)
bastion_install_syslog_ng: true

# Whether to install development packages (not recommended for production)
bastion_install_dev_packages: false

# Whether to encrypt /home directory
bastion_encrypt_home: false

# Encryption passphrase (only used if bastion_encrypt_home is true)
bastion_encryption_passphrase: ""

# First admin account configuration (only used for new installations)
bastion_first_admin:
  username: ""
  ssh_public_key: ""

# Additional configuration options for /etc/bastion/bastion.conf
bastion_config:
  bastionName: "sensfortress"

# Whether to install optional tools
bastion_install_yubico_piv_checker: false
bastion_install_mkhash_helper: false

# SSH hardening settings (only for new installations)
bastion_harden_ssh: true
bastion_regenerate_host_keys: true

# Backup configuration
bastion_backup_encryption_enabled: true
bastion_backup_dir: /root/backups

# Upgrade specific settings
bastion_upgrade_backup_before: true
bastion_upgrade_use_managed: false  # Use --managed-upgrade instead of --upgrade

# High Availability / Clustering configuration
bastion_ha_enabled: false
bastion_ha_role: master  # master or slave
bastion_ha_master_ip: ""  # IP address of the master bastion (required for slaves)
bastion_ha_slave_ips: []  # List of slave IP addresses (required for master)
bastion_ha_ssh_key_path: "/root/.ssh/id_master2slave"  # SSH key path for master-slave communication
bastion_ha_sync_user: "bastionsync"  # User for synchronization

# Configuration for osh-sync-watcher
bastion_ha_sync_syslog: "local6"
bastion_ha_sync_enabled: "{{ bastion_ha_enabled | ternary('1', '0') }}"
bastion_ha_sync_timeout: 120
bastion_ha_sync_rshcmd: "ssh -q -i {{ bastion_ha_ssh_key_path }} -o StrictHostKeyChecking=accept-new"
bastion_ha_sync_remoteuser: "{{ bastion_ha_sync_user }}"
bastion_ha_sync_remotehostlist: "{{ bastion_ha_slave_ips | join(' ') }}"
